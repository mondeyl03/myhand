<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control Mano por Voz</title>
<style>
  body { font-family: sans-serif; background: #111; color: white; text-align: center; padding: 20px; }
  button { font-size: 20px; padding: 10px 20px; margin: 20px; cursor: pointer; }
  #status { margin-top: 20px; font-size: 18px; }
</style>
</head>
<body>
<h1>Control de Mano Rob칩tica por Voz</h1>
<button id="start">游꿗 Hablar</button>
<div id="status">Presiona "Hablar" y di: abrir, cerrar o mover el pulgar a 90 grados</div>

<script>
const esp32IP = "192.168.4.1"; // Cambia por la IP de tu ESP32
const status = document.getElementById("status");
const btn = document.getElementById("start");

// Mapear nombre de dedo -> n칰mero de servo
const dedosMap = {
  "pulgar": 4,
  "indice": 3,
  "medio": 2,
  "corazon": 2, // opcional
  "anular": 1,
  "menique": 0,
  "me침ique": 0
};

function enviarComando(url){
  fetch(`http://${esp32IP}${url}`)
    .then(r => r.text())
    .then(txt => status.innerText = "ESP32 respondi칩: " + txt)
    .catch(err => status.innerText = "Error: " + err);
}

btn.addEventListener("click", ()=>{
  if(!('webkitSpeechRecognition' in window)){
    status.innerText = "Tu navegador no soporta reconocimiento de voz.";
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "es-ES";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();
  status.innerText = "Escuchando...";

  recognition.onresult = function(event){
    const comando = event.results[0][0].transcript.toLowerCase();
    status.innerText = "Comando: " + comando;

    // Abrir/cerrar todos
    if(comando.includes("abrir")){
      enviarComando("/open");
      return;
    }
    if(comando.includes("cerrar")){
      enviarComando("/close");
      return;
    }

    // Mover dedo por nombre
    const match = comando.match(/(pulgar|indice|medio|corazon|anular|menique|me침ique)\s*(?:a| )\s*(\d{1,3})/);
    if(match){
      const dedoNombre = match[1];
      const valor = parseInt(match[2]);
      if(valor < 0 || valor > 180){
        status.innerText = "츼ngulo inv치lido: " + valor;
        return;
      }
      const dedoNum = dedosMap[dedoNombre];
      enviarComando(`/servo?finger=${dedoNum}&value=${valor}`);
      return;
    }

    status.innerText = "Comando no reconocido";
  }

  recognition.onerror = function(event){
    status.innerText = "Error de reconocimiento: " + event.error;
  }
});
</script>
</body>
</html>
