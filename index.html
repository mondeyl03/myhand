// páginaWeb.h — versión mejorada estética y funcionalidad
const char webpage[] PROGMEM = R"rawliteral(
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Exoesqueleto de los Timbritos</title>
<style>
  body {
    font-family: 'Trebuchet MS', sans-serif;
    background: #0d1117;
    color: #e6eef6;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    background: #06b6d4;
    color: #0d1117;
    padding: 15px;
    margin: 0;
    font-size: 2em;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }
  h1 img {
    height: 50px;
  }
  .container {
    margin: 20px auto;
    max-width: 500px;
    background: #161b22;
    padding: 20px;
    border-radius: 15px;
  }
  .finger {
    margin: 15px 0;
    padding: 10px;
    border: 1px solid #06b6d4;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }
  .finger label {
    font-weight: bold;
    min-width: 100px;
    text-align: left;
  }
  input[type=range] {
    width: 150px;
  }
  .value {
    font-size: 1em;
    color: #94a3b8;
    width: 40px;
    text-align: center;
  }
  .btn {
    margin: 5px;
    padding: 12px 20px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1em;
  }
  .btn.openclose { background: #06b6d4; color: #0d1117; border: none; }
  .btn.pause { background: #dc2626; color: white; border: none; }
  .btn.micro { background: #16a34a; color: white; border: none; }
  .btn.arrow { background: #c0c0c0; color: #0d1117; border: none; width: 35px; font-size: 1.2em; }
  #commandDetected {
    margin: 10px 0;
    font-size: 1.1em;
    color: #16a34a;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>
  Exoesqueleto de los Timbritos
  <!-- <img src="ExoHand.jpg" alt="Logo"> -->
</h1>

<div class="container" id="sliders"></div>

<div>
  <button class="btn openclose" onclick="setAll(90)">Abrir Mano</button>
  <button class="btn openclose" onclick="setAll(0)">Cerrar Mano</button>
  <button class="btn micro" onclick="activateMicro()">Activar Micrófono</button>
</div>

<div id="commandDetected">Comando detectado: Ninguno</div>

<script>
const fingerNames = ["Meñique","Anular","Corazón","Índice","Pulgar"];
let positions = [90,90,90,90,90];
let lastPositions = [90,90,90,90,90];
const slidersDiv = document.getElementById('sliders');
let moving = [false,false,false,false,false]; // seguimiento de movimiento
let paused = [false,false,false,false,false];

function createFingerControl(idx){
  const cont = document.createElement('div');
  cont.className='finger';
  cont.innerHTML=`
    <label>${fingerNames[idx]}:</label>
    <button class="btn arrow" onclick="changePos(${idx}, -1)">&#9664;</button>
    <input type="range" min="0" max="90" value="${positions[idx]}" id="s${idx}" 
      oninput="manualMove(${idx}, this.value)">
    <button class="btn arrow" onclick="changePos(${idx}, 1)">&#9654;</button>
    <span class="value" id="val${idx}">${positions[idx]}</span>
    <button class="btn pause" onclick="regresarAnterior(${idx})">Regresar</button>
  `;
  slidersDiv.appendChild(cont);
}

for(let i=0;i<5;i++) createFingerControl(i);

// Mover manualmente (sin delay)
function manualMove(idx,val){
  val=parseInt(val);
  positions[idx]=val;
  document.getElementById('val'+idx).textContent=val;
  fetch(`/servo?finger=${idx}&value=${val}`).catch(()=>{});
}

// Flechas 1 en 1
function changePos(idx,delta){
  let val = positions[idx]+delta;
  if(val>90) val=90;
  if(val<0) val=0;
  positions[idx]=val;
  document.getElementById('s'+idx).value=val;
  document.getElementById('val'+idx).textContent=val;
  fetch(`/servo?finger=${idx}&value=${val}`).catch(()=>{});
}

// Regresar al último
function regresarAnterior(idx){
  const val = lastPositions[idx];
  positions[idx]=val;
  document.getElementById('s'+idx).value=val;
  document.getElementById('val'+idx).textContent=val;
  fetch(`/servo?finger=${idx}&value=${val}`).catch(()=>{});
}

// Abrir/Cerrar Mano suavemente 3 en 3 grados cada 2 seg
function setAll(target){
  for(let i=0;i<5;i++){
    paused[i]=false;
    moveTo(i,target);
  }
}

function moveTo(idx,target){
  moving[idx]=true;
  let step=target>positions[idx]?3:-3;
  function stepMove(){
    if(paused[idx]){ moving[idx]=false; return; }
    if((step>0 && positions[idx]>=target)||(step<0 && positions[idx]<=target)){
      positions[idx]=target;
      moving[idx]=false;
      lastPositions[idx]=target;
      document.getElementById('s'+idx).value=target;
      document.getElementById('val'+idx).textContent=target;
      if(idx===4 && target===90) document.getElementById('commandDetected').textContent="Mano abierta";
      if(idx===4 && target===0) document.getElementById('commandDetected').textContent="Mano cerrada";
      return;
    }
    positions[idx]+=step;
    if(positions[idx]<0) positions[idx]=0;
    if(positions[idx]>90) positions[idx]=90;
    document.getElementById('s'+idx).value=positions[idx];
    document.getElementById('val'+idx).textContent=positions[idx];
    fetch(`/servo?finger=${idx}&value=${positions[idx]}`).catch(()=>{});
    setTimeout(stepMove,2000);
  }
  stepMove();
}

// Pausar dedo
function pauseFinger(idx){
  paused[idx]=true;
}

// Micro (activar) — luego tu código JS de reconocimiento de voz
function activateMicro(){ 
  alert("Aquí va el reconocimiento de voz (presionar y dar comando)"); 
  document.getElementById('commandDetected').textContent="Comando detectado: ...";
}
</script>

</body>
</html>
)rawliteral";
